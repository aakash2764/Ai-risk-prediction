<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Healthcare AI Prediction Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            margin: 15px 0;
            gap: 10px;
            flex-wrap: wrap;
        }

        .tab-btn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #2c3e50;
            flex-grow: 1;
            text-align: center;
            max-width: 200px;
        }

        .tab-btn.active {
            background: #3498db;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            width: 100%;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            height: 100%;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .metric-card {
            text-align: center;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .metric-value {
            font-size: 2.2rem;
            font-weight: 800;
            margin: 8px 0;
        }

        .metric-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .chart-container {
            position: relative;
            height: 250px;
            margin-top: 10px;
        }

        .alert-badge {
            display: inline-block;
            background: #e74c3c;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }

        .status-low { background: #2ecc71; }
        .status-medium { background: #f39c12; }
        .status-high { background: #e74c3c; }

        .file-upload {
            margin: 20px 0;
            padding: 20px;
            border: 2px dashed #3498db;
            border-radius: 10px;
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
        }

        .file-input {
            margin: 10px;
            padding: 10px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }

        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }

        .data-table tr:hover {
            background: rgba(52, 152, 219, 0.1);
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            font-size: 1.1rem;
            color: #7f8c8d;
        }

        .patient-detail {
            background: linear-gradient(135deg, #8e44ad, #3498db);
            color: white;
        }

        .recommendation-list {
            list-style: none;
            padding: 0;
        }

        .recommendation-list li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
        }

        .recommendation-list li:before {
            content: "►";
            color: #3498db;
            margin-right: 10px;
            font-weight: bold;
        }

        .auto-refresh {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 15px;
            border-radius: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .refresh-btn {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: 600;
        }

        /* Add these styles to your existing <style> section */

        .patient-report-scrollable {
            max-height: 70vh;
            overflow-y: auto;
            padding-right: 10px;
            margin-top: 15px;
        }

        .patient-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            overflow-x: auto;
            padding-bottom: 5px;
            flex-wrap: wrap;
        }

        .patient-tab {
            background: #f1f2f6;
            border: none;
            padding: 12px 22px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #2c3e50;
            font-size: 1.05rem;
        }

        .patient-tab.active {
            background: #3498db;
            color: white;
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
            transform: translateY(-2px);
        }

        /* Make alerts tab take full width */
        #alerts .dashboard-grid {
            grid-template-columns: 1fr;
        }

        #alerts .card {
            width: 100%;
        }

        /* Add to your CSS styles */
        .loading.error {
            color: #e74c3c;
            font-weight: bold;
            padding: 20px;
            background: rgba(231, 76, 60, 0.1);
            border-radius: 8px;
            margin-top: 20px;
        }

        .tag-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 10px;
        }

        .tag {
            background: #f1f2f6;
            color: #2c3e50;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
        }

        .alert-tag {
            background: rgba(231, 76, 60, 0.15);
            color: #c0392b;
            font-weight: 600;
        }

        /* Add better styling for the patient section */
        .patient-section {
            margin-bottom: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.2rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            border-bottom: 1px solid #ecf0f1;
            padding-bottom: 8px;
        }

        /* Add to your CSS styles */
        .risk-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85rem;
            white-space: nowrap;
        }

        /* Patient table with improved responsiveness */
        .table-responsive {
            overflow-x: auto;
            margin-bottom: 20px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .patient-table {
            width: 100%;
            border-collapse: collapse;
        }

        .patient-table thead th {
            background-color: #f8f9fa;
            color: #2c3e50;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
            border-bottom: 1px solid #e1e1e1;
        }

        .patient-table tbody tr {
            border-bottom: 1px solid #ecf0f1;
            transition: background-color 0.3s ease;
        }

        .patient-table tbody tr:hover {
            background-color: rgba(52, 152, 219, 0.05);
        }

        .patient-table td {
            padding: 15px;
            vertical-align: middle;
        }

        /* Patient detail accordion */
        .patient-detail-row {
            background-color: #f9f9f9;
        }

        .patient-detail-content {
            display: none;
            padding: 0;
            transition: all 0.3s ease;
            overflow: hidden;
            max-height: 0;
        }

        .patient-detail-content.active {
            display: table-cell;
            padding: 20px 15px;
            max-height: 2000px; /* Large enough to show all content */
        }

        .patient-detail-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            padding: 20px;
        }

        /* View details button */
        .view-details-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .view-details-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .view-details-btn.active {
            background: #e74c3c;
        }

        .view-details-btn.active .btn-text {
            display: none;
        }

        .view-details-btn .btn-text-alt {
            display: none;
        }

        .view-details-btn.active .btn-text-alt {
            display: inline;
        }

        /* Patient detail inner content styling */
        .patient-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .patient-detail-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .patient-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .metric-box {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
        }

        .metric-box.highlighted {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .metric-title {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .patient-detail-section {
            margin-bottom: 20px;
        }

        .patient-detail-section h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #ecf0f1;
        }

        /* Improved patient cohort card styling */
        .patient-cohort-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .patient-cohort-header {
            background: linear-gradient(135deg, #3498db, #9b59b6);
            padding: 20px 25px;
            color: white;
        }
        
        .patient-cohort-header h3 {
            margin: 0;
            font-size: 1.6rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .patient-cohort-body {
            padding: 25px;
        }
        
        /* Patient controls styling */
        .patient-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .search-box {
            flex: 1;
            min-width: 250px;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px 20px;
            border-radius: 30px;
            border: 1px solid #ddd;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #f9f9f9;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            background: white;
        }
        
        .filter-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .filter-controls label {
            font-weight: 600;
            color: #7f8c8d;
        }
        
        .filter-controls select {
            padding: 10px 20px;
            border-radius: 30px;
            border: 1px solid #ddd;
            font-size: 1rem;
            background-color: #f9f9f9;
            cursor: pointer;
            transition: all 0.3s ease;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 15px;
            padding-right: 40px;
        }
        
        .filter-controls select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            background-color: white;
        }
        
        /* Patient table with improved styling */
        .table-responsive {
            overflow-x: auto;
            margin-bottom: 20px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .patient-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .patient-table thead th {
            background-color: #34495e;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .patient-table tbody tr:nth-child(4n+1),
        .patient-table tbody tr:nth-child(4n+2) {
            background-color: white;
        }
        
        .patient-table tbody tr:nth-child(4n+3),
        .patient-table tbody tr:nth-child(4n+4) {
            background-color: #f0f7ff;
        }
        
        /* Exception for detail rows to match their parent row */
        .patient-table tbody tr.patient-detail-row:nth-child(4n+4),
        .patient-table tbody tr.patient-detail-row:nth-child(4n+2) {
            background-color: white;
        }
        
        .patient-table tbody tr.patient-detail-row:nth-child(4n+3),
        .patient-table tbody tr.patient-detail-row:nth-child(4n+5) {
            background-color: #f0f7ff;
        }
        
        .patient-table tbody tr:hover:not(.patient-detail-row) {
            background-color: rgba(52, 152, 219, 0.1);
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .patient-table td {
            padding: 15px;
            vertical-align: middle;
            transition: all 0.3s ease;
        }
        
        /* Risk badge styling */
        .risk-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85rem;
            white-space: nowrap;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            letter-spacing: 0.5px;
            text-transform: uppercase;
            font-size: 0.75rem;
        }
        
        .risk-low {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
        }
        
        .risk-medium, .risk-medium-low, .risk-medium-high {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }
        
        .risk-high {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }
        
        /* Clinical alerts styling */
        .tag-container {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            max-width: 300px;
        }
        
        .tag {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            white-space: nowrap;
            background: #ecf0f1;
            color: #7f8c8d;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .tag:hover {
            transform: translateY(-1px);
        }
        
        .alert-tag {
            background: #ffecef;
            color: #e74c3c;
            font-weight: 600;
        }
        
        /* View details button */
        .view-details-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 2px 5px rgba(52, 152, 219, 0.3);
        }
        
        .view-details-btn:hover {
            background: linear-gradient(135deg, #2980b9, #3498db);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.4);
        }
        
        .view-details-btn.active {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            box-shadow: 0 2px 5px rgba(231, 76, 60, 0.3);
        }
        
        .view-details-btn .btn-icon {
            font-size: 1.1rem;
        }
        
        .view-details-btn.active .btn-text {
            display: none;
        }
        
        .view-details-btn .btn-text-alt {
            display: none;
        }
        
        .view-details-btn.active .btn-text-alt {
            display: inline;
        }
        
        /* Patient detail styling */
        .patient-detail-content {
            display: none;
            padding: 0;
            transition: all 0.3s ease;
        }
        
        .patient-detail-content.active {
            display: table-cell;
            padding: 0;
        }
        
        .patient-detail-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            padding: 20px;
            margin: 10px 5px;
            border: 1px solid #e1e8ed;
        }
        
        /* Pagination styling */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 25px;
            gap: 8px;
        }
        
        .page-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            background: white;
            color: #555;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .page-btn:hover:not(:disabled) {
            background: #3498db;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(52, 152, 219, 0.3);
        }
        
        .page-btn.active {
            background: #3498db;
            color: white;
            box-shadow: 0 3px 8px rgba(52, 152, 219, 0.4);
        }
        
        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .page-text {
            margin: 0 10px;
            font-weight: 500;
            color: #7f8c8d;
        }
        
        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #7f8c8d;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        /* Loading state */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 50px 20px;
            font-weight: 500;
            color: #7f8c8d;
        }
        
        /* Fix patient report container styling */
        .patient-report-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            overflow: hidden;
            margin-top: 20px;
            margin-bottom: 30px;
            width: 100%; /* Ensure full width */
        }

        .patient-report-body {
            padding: 25px;
            overflow: visible; /* Changed from hidden to prevent content cutoff */
        }

        /* Improve patient sections layout */
        .patient-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            overflow: visible; /* Allow content to be fully visible */
            width: 100%; /* Ensure sections take full width */
        }

        /* Fix data tables in reports */
        .data-table {
            width: 100%;
            table-layout: auto; /* Changed from fixed to auto to better handle content */
            border-collapse: collapse;
            background: white;
            margin-bottom: 10px;
        }

        .data-table th, 
        .data-table td {
            padding: 12px 15px;
            text-align: left;
            word-break: normal; /* Changed from break-word to normal */
            overflow-wrap: break-word; /* Better handling of long text */
            max-width: 300px; /* Limit cell width */
        }

        /* Improve tag container layout */
        .tag-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 10px 0;
            width: 100%; /* Full width */
        }

        /* Better stats grid layout */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
            width: 100%; /* Ensure full width */
        }

        /* Improve scrollable table display */
        .scrollable-table {
            max-height: 300px;
            overflow-y: auto;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            margin-top: 15px;
            width: 100%; /* Ensure full width */
        }

        /* Add spacing between sections */
        .section-title {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ecf0f1;
        }

        /* Fix patient card */
        .patient-card {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* Add responsive adjustments */
        @media (max-width: 992px) {
            .container {
                padding: 10px;
            }
            
            .header {
                padding: 15px;
                margin-bottom: 15px;
            }
            
            .header h1 {
                font-size: 1.8rem;
                margin-bottom: 5px;
            }
            
            .header p {
                font-size: 0.9rem;
            }
            
            .dashboard-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 10px;
                margin-bottom: 15px;
            }
            
            .card {
                padding: 15px;
            }
            
            .card-title {
                font-size: 1rem;
                margin-bottom: 10px;
            }
            
            .metric-value {
                font-size: 1.8rem;
                margin: 6px 0;
            }
            
            .metric-label {
                font-size: 0.8rem;
            }
            
            .chart-container {
                height: 220px;
            }
            
            .patient-report-body {
                padding: 15px;
            }
            
            .patient-section {
                padding: 15px;
            }
            
            .data-table th, 
            .data-table td {
                padding: 8px 10px;
                font-size: 0.9rem;
            }
            
            .patient-controls {
                flex-wrap: wrap;
            }
            
            .search-box {
                flex: 1 1 100%;
                margin-bottom: 10px;
            }
            
            .filter-controls {
                flex: 1 1 100%;
                justify-content: space-between;
            }
        }
        
        @media (max-width: 576px) {
            .header h1 {
                font-size: 1.5rem;
            }
            
            .tab-btn {
                padding: 8px 12px;
                font-size: 0.9rem;
                max-width: none;
                flex: 1 1 auto;
            }
            
            .card {
                padding: 12px;
            }
            
            .metric-value {
                font-size: 1.5rem;
            }
            
            .chart-container {
                height: 200px;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>🏥 Healthcare AI Prediction Dashboard</h1>
            <p>Real-time patient risk assessment and clinical decision support</p>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="tab-btn active" onclick="switchTab('overview')">📊 Overview</button>
            <button class="tab-btn" onclick="switchTab('validation')">🔬 Model Validation</button>
            <button class="tab-btn" onclick="switchTab('patients')">👥 Patient Cohort</button>
            <button class="tab-btn" onclick="switchTab('upload')">📁 Data Upload</button>
        </div>

        <!-- Overview Tab -->
        <div id="overview" class="tab-content active">
            <!-- Key Metrics -->
            <div class="dashboard-grid">
                <div class="card metric-card">
                    <h3 class="card-title">Total Patients</h3>
                    <div class="metric-value" id="total-patients">-</div>
                    <div class="metric-label">Currently Monitored</div>
                </div>

                <div class="card metric-card" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
                    <h3 class="card-title">High Risk Patients</h3>
                    <div class="metric-value" id="high-risk-count">-</div>
                    <div class="metric-label">Require Immediate Attention</div>
                </div>

                <div class="card metric-card" style="background: linear-gradient(135deg, #f39c12, #e67e22);">
                    <h3 class="card-title">Average Risk Score</h3>
                    <div class="metric-value" id="avg-risk-score">-</div>
                    <div class="metric-label">Population Average</div>
                </div>
            </div>
            
            <!-- Charts and Summaries -->
            <div class="dashboard-grid" style="grid-template-columns: 3fr 2fr;">
                <!-- Risk Distribution Chart -->
                <div class="card">
                    <h3 class="card-title">🎯 Risk Level Distribution</h3>
                    <div class="chart-container" style="height: 260px;">
                        <canvas id="risk-distribution-chart"></canvas>
                    </div>
                </div>

                <!-- Conditions and Alerts -->
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    <!-- Common Conditions -->
                    <div class="card">
                        <h3 class="card-title">🏥 Common Conditions</h3>
                        <div id="common-conditions" class="loading">Loading conditions...</div>
                    </div>

                    <!-- Clinical Alerts Summary -->
                    <div class="card">
                        <h3 class="card-title">🚨 Alert Summary</h3>
                        <div id="alert-summary" class="loading">Loading alerts...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Validation Tab -->
        <div id="validation" class="tab-content">
            <!-- Metrics -->
            <div class="dashboard-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <!-- AUROC -->
                <div class="card metric-card" style="background: linear-gradient(135deg, #9b59b6, #8e44ad);">
                    <h3 class="card-title">AUROC</h3>
                    <div class="metric-value" id="auroc-metric">-</div>
                    <div class="metric-label">Discrimination ability</div>
                </div>
                <!-- AUPRC -->
                <div class="card metric-card" style="background: linear-gradient(135deg, #1abc9c, #16a085);">
                    <h3 class="card-title">AUPRC</h3>
                    <div class="metric-value" id="auprc-metric">-</div>
                    <div class="metric-label">Precision-recall performance</div>
                </div>
                <!-- Accuracy -->
                <div class="card metric-card" style="background: linear-gradient(135deg, #f39c12, #e67e22);">
                    <h3 class="card-title">Accuracy</h3>
                    <div class="metric-value" id="accuracy-metric">-</div>
                    <div class="metric-label">Overall correct predictions</div>
                </div>
            </div>
            
            <!-- Charts -->
            <div class="dashboard-grid" style="grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 15px; margin-top:15px;">
                <!-- Calibration Curve -->
                <div class="card">
                    <h3 class="card-title" style="text-align:center;">Calibration Curve</h3>
                    <div class="chart-container" style="height:260px;">
                        <canvas id="calibration-chart"></canvas>
                    </div>
                    <div style="text-align:center; margin-top:10px; color:#7f8c8d;">Model calibration: predicted vs. observed</div>
                </div>
                <!-- Confusion Matrix -->
                <div class="card">
                    <h3 class="card-title" style="text-align:center;">Confusion Matrix</h3>
                    <div style="display: flex; justify-content: center; align-items: center; height: 260px;">
                        <table class="data-table" style="font-size:1.1rem; width:80%; text-align:center;">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th>Pred 0</th>
                                    <th>Pred 1</th>
                                </tr>
                            </thead>
                            <tbody id="confusion-matrix-body">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                    <div style="text-align:center; margin-top:10px; color:#7f8c8d;">Breakdown of predictions</div>
                </div>
            </div>
        </div>

        <!-- Patients Tab -->
        <div id="patients" class="tab-content">
            <div class="patient-cohort-card">
                <div class="patient-cohort-header">
                    <h3>👥 Patient Cohort</h3>
                </div>
                <div class="patient-cohort-body">
                    <div class="patient-controls">
                        <div class="search-box">
                            <input type="text" id="patient-search" placeholder="Search patients by ID or condition..." onkeyup="filterPatients()">
                        </div>
                        <div class="filter-controls">
                            <label for="risk-filter">Risk Level:</label>
                            <select id="risk-filter" onchange="filterPatients()">
                                <option value="all">All Risks</option>
                                <option value="high">High Risk</option>
                                <option value="medium">Medium Risk</option>
                                <option value="low">Low Risk</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Table with responsive container -->
                    <div class="table-responsive" style="margin-top: 15px; overflow-x: auto; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
                        <div id="patient-table-container" class="loading">Loading patient data...</div>
                    </div>
                </div>
            </div>
            
            <!-- Patient Detail Modal -->
            <div id="patient-detail-modal" class="modal">
                <div class="modal-content">
                    <span class="close-modal" onclick="closePatientDetail()">&times;</span>
                    <div id="patient-detail-content"></div>
                </div>
            </div>
        </div>

        <!-- Upload Tab -->
        <div id="upload" class="tab-content">
            <div class="dashboard-grid" style="grid-template-columns: 1fr;">
                <div class="card">
                    <h3 class="card-title">📁 Upload Prediction Data</h3>
                    <div class="file-upload">
                        <p style="margin-bottom:10px;">Upload JSON files to update the dashboard</p>
                        <input type="file" id="json-file" accept=".json" class="file-input" onchange="handleFileUpload(event)">
                        <div id="upload-status" style="margin-top:10px;"></div>
                    </div>
                    
                    <div id="file-preview" style="margin-top: 15px;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global data storage
        let dashboardData = {
            predictions: null,
            training: null,
            patients: [],
            patientReports: {}
        };

        let charts = {};

        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
            setupResponsiveLayout();
        });

        // Load all required files
        async function loadAllData() {
            try {
                dashboardData.predictions = await fetchJSON('predictions.json');
                // Load training_results.json instead of validation_report.json
                dashboardData.training = await fetchJSON('training_results.json');
                dashboardData.patients = await fetchCSV('patients.csv');
                const highRiskIds = [2955, 5417];
                for (const id of highRiskIds) {
                    try {
                        const report = await fetchJSON(`patient_${id}_report.json`);
                        dashboardData.patientReports[id] = report;
                        console.log(`Loaded patient report for ID: ${id}`, report);
                    } catch (err) {
                        console.error(`Failed to load patient_${id}_report.json: ${err.message}`);
                    }
                }
                updateDashboard();
            } catch (err) {
                console.error('Failed to load dashboard data:', err);
                alert('Failed to load dashboard data: ' + err);
            }
        }

        // Fetch JSON file
        async function fetchJSON(filename) {
            const res = await fetch(filename);
            if (!res.ok) throw new Error(`Failed to load ${filename}`);
            return await res.json();
        }

        // Fetch CSV file and convert to JSON
        async function fetchCSV(filename) {
            const res = await fetch(filename);
            if (!res.ok) throw new Error(`Failed to load ${filename}`);
            const text = await res.text();
            return csvToJson(text);
        }

        // Simple CSV to JSON converter
        function csvToJson(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',');
            return lines.slice(1).map(line => {
                const values = line.split(',');
                const obj = {};
                headers.forEach((h, i) => obj[h.trim()] = values[i].trim());
                return obj;
            });
        }

        // Update all dashboard elements
        function updateDashboard() {
            updateOverview();
            updateValidation();
            updatePatientTable();
        }

        // Update overview tab
        function updateOverview() {
            const data = dashboardData.predictions;
            if (!data) return;

            document.getElementById('total-patients').textContent = data.total_patients.toLocaleString();
            document.getElementById('high-risk-count').textContent = (data.risk_distribution.High || 0).toLocaleString();
            document.getElementById('avg-risk-score').textContent = data.deterioration_predictions.average_probability.toFixed(3);

            // Update risk distribution chart
            updateRiskDistributionChart();
            
            // Update common conditions
            updateCommonConditions();
            
            // Update alert summary
            updateAlertSummary();
        }

        // Update validation tab
        function updateValidation() {
            const metrics = dashboardData.training?.deterioration_metrics;
            if (!metrics) return;

            document.getElementById('auroc-metric').textContent = metrics.auroc.toFixed(3);
            document.getElementById('auprc-metric').textContent = metrics.auprc.toFixed(3);
            document.getElementById('accuracy-metric').textContent = metrics.accuracy.toFixed(3);

            // Confusion matrix
            const cm = metrics.confusion_matrix;
            document.getElementById('confusion-matrix-body').innerHTML = `
                <tr>
                    <td><b>True 0</b></td>
                    <td>${cm[0][0]}</td>
                    <td>${cm[0][1]}</td>
                </tr>
                <tr>
                    <td><b>True 1</b></td>
                    <td>${cm[1][0]}</td>
                    <td>${cm[1][1]}</td>
                </tr>
            `;

            // Calibration chart
            updateCalibrationChart(metrics.calibration);
        }

        function updateCalibrationChart(calibration) {
            const canvas = document.getElementById('calibration-chart');
            const ctx = canvas.getContext('2d');
            // Clear previous chart/message
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (
                !calibration ||
                !Array.isArray(calibration.fraction_positive) ||
                !Array.isArray(calibration.mean_predicted_value) ||
                calibration.fraction_positive.length < 2 ||
                calibration.mean_predicted_value.length < 2 ||
                calibration.fraction_positive.length !== calibration.mean_predicted_value.length
            ) {
                // Show message if not enough data
                ctx.font = "20px Segoe UI";
                ctx.fillStyle = "#7f8c8d";
                ctx.textAlign = "center";
                ctx.fillText("No calibration data available", canvas.width / 2, canvas.height / 2);
                return;
            }

            if (charts.calibration) charts.calibration.destroy();

            charts.calibration = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Fraction Positive',
                        data: calibration.fraction_positive.map((y, i) => ({x: calibration.mean_predicted_value[i], y})),
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.2)',
                        fill: true,
                        tension: 0.3,
                        pointRadius: 5,
                        pointBackgroundColor: '#3498db'
                    }, {
                        label: 'Perfect Calibration',
                        data: calibration.mean_predicted_value.map(x => ({x, y: x})),
                        borderColor: '#2ecc71',
                        borderDash: [5,5],
                        fill: false,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Mean Predicted Value' },
                            type: 'linear',
                            min: 0,
                            max: 1
                        },
                        y: {
                            title: { display: true, text: 'Fraction Positive' },
                            min: 0,
                            max: 1
                        }
                    }
                }
            });
        }

        // Update risk distribution chart
        function updateRiskDistributionChart() {
            const ctx = document.getElementById('risk-distribution-chart').getContext('2d');
            const data = dashboardData.predictions.risk_distribution;
            
            if (charts.riskDistribution) {
                charts.riskDistribution.destroy();
            }

            charts.riskDistribution = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(data),
                    datasets: [{
                        data: Object.values(data),
                        backgroundColor: [
                            '#2ecc71',
                            '#f39c12',
                            '#e67e22',
                            '#e74c3c'
                        ],
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Update risk statistics chart
        function updateRiskStatsChart() {
            const ctx = document.getElementById('risk-stats-chart').getContext('2d');
            const data = dashboardData.validation.patients_by_risk_level;
            
            if (charts.riskStats) {
                charts.riskStats.destroy();
            }

            charts.riskStats = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(data),
                    datasets: [{
                        label: 'Number of Patients',
                        data: Object.values(data),
                        backgroundColor: 'rgba(52, 152, 219, 0.7)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Update common conditions
        function updateCommonConditions() {
            const container = document.getElementById('common-conditions');
            const conditions = dashboardData.predictions.common_conditions;
            
            let html = '<ul class="recommendation-list">';
            Object.entries(conditions).slice(0, 5).forEach(([condition, count]) => {
                html += `<li>${condition}: <strong>${count}</strong> patients</li>`;
            });
            html += '</ul>';
            
            container.innerHTML = html;
        }

        // Update alert summary
        function updateAlertSummary() {
            const container = document.getElementById('alert-summary');
            const alerts = dashboardData.predictions.alert_summary;
            
            let html = '<ul class="recommendation-list">';
            Object.entries(alerts).slice(0, 5).forEach(([alert, count]) => {
                const priority = alert.includes('CRITICAL') ? 'high' : 'medium';
                html += `<li><span class="status-indicator status-${priority}"></span>${alert}: <strong>${count}</strong></li>`;
            });
            html += '</ul>';
            
            container.innerHTML = html;
        }

        // Update critical clinical alerts with colorful UI
        function updateCriticalAlerts() {
            const container = document.getElementById('critical-alerts');
            const ids = [2955, 5417]; // Patient IDs
            
            if (!dashboardData.patientReports || Object.keys(dashboardData.patientReports).length === 0) {
                container.innerHTML = '<div class="loading">No patient reports found. Check data files.</div>';
                return;
            }
            
            let html = `
                <div class="patient-report-container">
                    <div class="patient-tabs">
                        ${ids.map((id, index) => `
                            <button class="patient-tab ${index === 0 ? 'active' : ''}" 
                                    onclick="showPatientReport(${id})">
                                    Patient ${id}
                            </button>`).join('')}
                    </div>
                    <div class="patient-report-body" id="patient-report-content">
                        <div class="colorful-spinner"></div>
                        <p style="text-align:center;color:#7f8c8d;margin-top:10px;">Loading patient data...</p>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
            
            // Show the first patient by default
            if (ids.length > 0) {
                showPatientReport(ids[0]);
            }
        }

        // Show patient report with improved UI
        function showPatientReport(patientId) {
            // Update active tab
            document.querySelectorAll('.patient-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.textContent.trim().includes(patientId.toString())) {
                    tab.classList.add('active');
                }
            });
            
            const container = document.getElementById('patient-report-content');
            const report = dashboardData.patientReports[patientId];
            
            if (!report) {
                container.innerHTML = `
                    <div class="loading error">
                        <h3>😕 Patient report not found</h3>
                        <p>Please check if patient_${patientId}_report.json exists.</p>
                    </div>`;
                console.error(`Patient report for ID ${patientId} not found in dashboardData:`, dashboardData);
                return;
            }
            
            try {
                // Format risk score as percentage
                const riskScorePercent = (report.overall_risk_assessment?.risk_score * 100).toFixed(1) + '%';
                const deteriorationPercent = (report.overall_risk_assessment?.deterioration_probability * 100).toFixed(1) + '%';
                
                // Determine risk level class
                const riskLevel = report.overall_risk_assessment?.risk_level || 'Unknown';
                const riskClass = riskLevel === 'High' ? 'risk-high' : 
                                 (riskLevel === 'Medium' ? 'risk-medium' : 'risk-low');
                
                let html = `
                    <div class="patient-card">
                        <div class="patient-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 class="patient-id" style="font-size: 1.5rem; font-weight: 700;">Patient ID: ${report.patient_id || patientId}</h3>
                            <div class="risk-indicator">
                                <span>Risk Level:</span>
                                <span class="risk-badge ${riskClass}">${riskLevel}</span>
                            </div>
                        </div>
                        
                        <div class="stats-grid">
                            <div class="stat-box" style="background: #f1f2f6; padding: 15px; border-radius: 10px; text-align: center;">
                                <div style="color: #7f8c8d; font-size: 0.9rem;">Risk Score</div>
                                <div style="font-size: 1.5rem; font-weight: 700; color: #2c3e50;">${riskScorePercent}</div>
                            </div>
                            <div class="stat-box" style="background: #f1f2f6; padding: 15px; border-radius: 10px; text-align: center;">
                                <div style="color: #7f8c8d; font-size: 0.9rem;">Deterioration</div>
                                <div style="font-size: 1.5rem; font-weight: 700; color: #2c3e50;">${deteriorationPercent}</div>
                            </div>
                            <div class="stat-box" style="background: #f1f2f6; padding: 15px; border-radius: 10px; text-align: center;">
                                <div style="color: #7f8c8d; font-size: 0.9rem;">Data Completeness</div>
                                <div style="font-size: 1.5rem; font-weight: 700; color: #2c3e50;">${report.data_quality?.data_completeness || 'N/A'}</div>
                            </div>
                            <div class="stat-box" style="background: #f1f2f6; padding: 15px; border-radius: 10px; text-align: center;">
                                <div style="color: #7f8c8d; font-size: 0.9rem;">Days of Data</div>
                                <div style="font-size: 1.5rem; font-weight: 700; color: #2c3e50;">${report.data_quality?.days_of_data || 'N/A'}</div>
                            </div>
                        </div>
                        
                        <!-- Clinical Alerts Section -->
                        <div class="patient-section">
                            <h4 class="section-title"><span class="icon" style="background: #3498db; color: white; width: 30px; height: 30px; display: inline-flex; align-items: center; justify-content: center; border-radius: 50%; margin-right: 8px;">🚨</span>Clinical Alerts</h4>
                            <div class="tag-container">
                                ${
                                    Array.isArray(report.clinical_alerts?.alerts)
                                    ? report.clinical_alerts.alerts.map(a =>
                                        `<span class="tag alert-tag">${a}</span>`
                                      ).join('')
                                    : '<span class="tag">No alerts</span>'
                                }
                            </div>
                            ${report.clinical_alerts?.requires_immediate_attention ? 
                                '<div class="alert-note" style="margin-top: 10px; padding: 10px; background: rgba(231, 76, 60, 0.1); color: #e74c3c; border-radius: 8px; font-weight: 500;">⚠️ <strong>IMMEDIATE ATTENTION REQUIRED</strong> - Urgent clinical review recommended</div>' : ''}
                        </div>
                        
                        <!-- Predicted Conditions Section -->
                        <div class="patient-section">
                            <h4 class="section-title"><span class="icon" style="background: #3498db; color: white; width: 30px; height: 30px; display: inline-flex; align-items: center; justify-content: center; border-radius: 50%; margin-right: 8px;">🩺</span>Predicted Conditions</h4>
                            <div class="tag-container">
                                ${
                                    Array.isArray(report.predicted_conditions?.conditions)
                                    ? report.predicted_conditions.conditions.map(c =>
                                        `<span class="tag">${c}</span>`
                                      ).join('')
                                    : '<span class="tag">No conditions</span>'
                                }
                            </div>
                            ${report.predicted_conditions?.confidence ? 
                                `<small style="display: block; margin-top: 10px; color: #7f8c8d; font-style: italic;">${report.predicted_conditions.confidence}</small>` : ''}
                        </div>
                        
                        <!-- Clinical Interpretation Section -->
                        <div class="patient-section">
                            <h4 class="section-title"><span class="icon" style="background: #3498db; color: white; width: 30px; height: 30px; display: inline-flex; align-items: center; justify-content: center; border-radius: 50%; margin-right: 8px;">⚠️</span>Clinical Interpretation</h4>
                            <p style="line-height: 1.6;">${report.overall_risk_assessment?.clinical_interpretation || 'No interpretation available'}</p>
                        </div>
                        
                        <!-- Data Quality Section -->
                        <div class="patient-section">
                            <h4 class="section-title"><span class="icon" style="background: #3498db; color: white; width: 30px; height: 30px; display: inline-flex; align-items: center; justify-content: center; border-radius: 50%; margin-right: 8px;">📊</span>Data Quality</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                                <div style="background: #f1f2f6; padding: 15px; border-radius: 10px; text-align: center;">
                                    <div style="color: #7f8c8d; font-size: 0.9rem;">Days of Data</div>
                                    <div style="font-size: 1.5rem; font-weight: 700; color: #2c3e50;">${report.data_quality?.days_of_data ?? '-'}</div>
                                </div>
                                <div style="background: #f1f2f6; padding: 15px; border-radius: 10px; text-align: center;">
                                    <div style="color: #7f8c8d; font-size: 0.9rem;">Completeness</div>
                                    <div style="font-size: 1.5rem; font-weight: 700; color: #2c3e50;">${report.data_quality?.data_completeness ?? '-'}</div>
                                </div>
                                <div style="background: #f1f2f6; padding: 15px; border-radius: 10px; text-align: center;">
                                    <div style="color: #7f8c8d; font-size: 0.9rem;">Last Recorded</div>
                                    <div style="font-size: 1.5rem; font-weight: 700; color: #2c3e50;">Day ${report.data_quality?.last_recorded_day ?? '-'}</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Key Risk Factors Section -->
                        <div class="patient-section">
                            <h4 class="section-title"><span class="icon" style="background: #3498db; color: white; width: 30px; height: 30px; display: inline-flex; align-items: center; justify-content: center; border-radius: 50%; margin-right: 8px;">⚕️</span>Key Risk Factors</h4>
                            <div class="scrollable-table">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Factor</th>
                                            <th>Explanation</th>
                                            <th>Priority</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${
                                            Array.isArray(report.key_risk_factors)
                                            ? report.key_risk_factors.map(f =>
                                                `<tr>
                                                    <td style="width: 20%;"><strong>${f.factor ? f.factor.replace(/_/g, ' ') : ''}</strong></td>
                                                    <td style="width: 60%;">${f.explanation || ''}</td>
                                                    <td style="width: 20%;">
                                                        <span class="tag ${f.priority === 'High' ? 'alert-tag' : ''}">
                                                            ${f.priority || ''}
                                                        </span>
                                                    </td>
                                                </tr>`
                                              ).join('')
                                            : '<tr><td colspan="3">No risk factors</td></tr>'
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Recommendations Section -->
                        <div class="patient-section">
                            <h4 class="section-title"><span class="icon" style="background: #3498db; color: white; width: 30px; height: 30px; display: inline-flex; align-items: center; justify-content: center; border-radius: 50%; margin-right: 8px;">📋</span>Recommendations</h4>
                            <div class="recommendations-list">
                                <ol style="padding-left: 20px; margin-top: 10px; line-height: 1.6;">
                                    ${
                                        Array.isArray(report.recommendations)
                                        ? report.recommendations.map(r => `<li>${r}</li>`).join('')
                                        : '<li>No recommendations</li>'
                                    }
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        } catch (err) {
            container.innerHTML = `<div class="loading error">Error displaying patient report: ${err.message}</div>`;
            console.error("Error in showPatientReport:", err);
        }
    }

    // Add this function to your script section before updateDashboard()
    function setupResponsiveLayout() {
    // Adjust dashboard grid based on screen size
    function adjustLayout() {
        const dashboardGrids = document.querySelectorAll('.dashboard-grid');
        const windowWidth = window.innerWidth;
        
        dashboardGrids.forEach(grid => {
            if (windowWidth < 768) {
                grid.style.gridTemplateColumns = '1fr'; // Single column on small screens
            } else if (windowWidth < 1200) {
                grid.style.gridTemplateColumns = 'repeat(2, 1fr)'; // Two columns on medium screens
            } else {
                // Reset to the original CSS for larger screens
                grid.style.gridTemplateColumns = 'repeat(auto-fit, minmax(300px, 1fr))';
            }
        });
        
        // Adjust the overview risk distribution chart
        const overviewTab = document.getElementById('overview');
        if (overviewTab) {
            const riskDistCard = overviewTab.querySelector('.dashboard-grid .card:nth-child(4)');
            if (riskDistCard) {
                if (windowWidth < 768) {
                    riskDistCard.style.gridColumn = 'span 1';
                } else {
                    riskDistCard.style.gridColumn = 'span 2';
                }
            }
        }
    }
    
    // Initial adjustment
    adjustLayout();
    
    // Re-adjust on window resize
    window.addEventListener('resize', adjustLayout);
}

        // Update the document.addEventListener function to call setupResponsiveLayout
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
            setupResponsiveLayout();
        });

        // Handle tab switching
        function switchTab(tabId) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Deactivate all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabId).classList.add('active');
            
            // Activate the clicked button
            document.querySelector(`.tab-btn[onclick="switchTab('${tabId}')"]`).classList.add('active');
        }

        // Setup auto-refresh
        function setupAutoRefresh() {
            const checkbox = document.getElementById('auto-refresh');
            let intervalId = null;
            
            function toggleAutoRefresh() {
                if (checkbox.checked) {
                    intervalId = setInterval(refreshAllData, 30000);
                } else if (intervalId) {
                    clearInterval(intervalId);
                }
            }
            
            checkbox.addEventListener('change', toggleAutoRefresh);
            toggleAutoRefresh(); // Initial setup
        }

        // Refresh all data
        function refreshAllData() {
            loadAllData();
        }

        // Handle file upload
        function handleFileUpload(event) {
            const file = event.target.files[0];
            const status = document.getElementById('upload-status');
            const preview = document.getElementById('file-preview');
            
            if (!file) {
                status.innerHTML = 'No file selected';
                return;
            }
            
            status.innerHTML = `Reading file: ${file.name}`;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = JSON.parse(e.target.result);
                    status.innerHTML = `<span style="color: #2ecc71;">✓ File parsed successfully</span>`;
                    preview.innerHTML = `<pre style="background:#f8f9fa; padding:15px; border-radius:5px; overflow:auto; max-height:300px;">${JSON.stringify(content, null, 2)}</pre>`;
                    
                    // Optional: Process the uploaded file
                    // processUploadedData(content);
                    
                } catch (error) {
                    status.innerHTML = `<span style="color: #e74c3c;">✗ Error parsing file: ${error.message}</span>`;
                    preview.innerHTML = '';
                }
            };
            
            reader.onerror = function() {
                status.innerHTML = `<span style="color: #e74c3c;">✗ Error reading file</span>`;
            };
            
            reader.readAsText(file);
        }

        // Update patient table with the actual patient data from patients.csv
        function updatePatientTable() {
            const container = document.getElementById('patient-table-container');
            
            if (!dashboardData.patients || !Array.isArray(dashboardData.patients) || dashboardData.patients.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div style="font-size: 3rem; margin-bottom: 10px;">👥</div>
                        <h3>No patient data available</h3>
                        <p>Please check if patients.csv file exists and is properly formatted.</p>
                    </div>
                `;
                return;
            }
            
            // Create pagination variables - 5 patients per page as requested
            const itemsPerPage = 5;
            let currentPage = 1;
            const totalPages = Math.ceil(dashboardData.patients.length / itemsPerPage);
            
            // Setup table with pagination
            let html = `
                <div class="table-responsive">
                    <table class="patient-table" id="patient-data-table">
                        <thead>
                            <tr>
                                <th>Patient ID</th>
                                <th>Risk Level</th>
                                <th>Risk Score</th>
                                <th>Deterioration</th>
                                <th>Clinical Alerts</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="patient-table-body">
                            <!-- Rows will be populated by renderPatientPage function -->
                        </tbody>
                    </table>
                </div>
                
                <div class="pagination" id="pagination-container">
                    <!-- Pagination buttons will be added here -->
                </div>
            `;
            
            container.innerHTML = html;
            container.classList.remove('loading');
            
            // Initial rendering of the first page
            renderPatientPage(currentPage);
            setupPagination(totalPages, currentPage);
        }
        
        // Render specific page of patient data
        function renderPatientPage(page) {
            const tbody = document.getElementById('patient-table-body');
            const itemsPerPage = 5; // 5 patients per page as requested
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, dashboardData.patients.length);
            
            let html = '';
            
            // Generate rows for this page
            for (let i = startIndex; i < endIndex; i++) {
                const patient = dashboardData.patients[i];
                const patientId = patient.PatientID;
                
                // Determine risk class for styling
                let riskClass = "";
                const riskLevel = patient.Risk_Level;
                
                if (riskLevel.includes("High")) {
                    riskClass = "risk-high";
                } else if (riskLevel.includes("Medium")) {
                    riskClass = "risk-medium";
                } else {
                    riskClass = "risk-low";
                }
                
                // Format clinical alerts
                let alertsHtml = "";
                if (patient.Clinical_Alerts && patient.Clinical_Alerts !== "No_Alerts") {
                    const alerts = patient.Clinical_Alerts.split('|');
                    alertsHtml = alerts.map(alert => {
                        const isCritical = alert.includes("CRITICAL");
                        return `<span class="tag ${isCritical ? 'alert-tag' : ''}">${alert.replace(/_/g, ' ')}</span>`;
                    }).join('');
                } else {
                    alertsHtml = '<span class="tag">No Alerts</span>';
                }
                
                // Generate the row
                html += `
                    <tr id="patient-row-${patientId}" data-patient-id="${patientId}">
                        <td><strong>${patientId}</strong></td>
                        <td>
                            <span class="risk-badge ${riskClass}">${riskLevel.replace(/-/g, ' ')}</span>
                        </td>
                        <td>${(parseFloat(patient.Risk_Score) * 100).toFixed(1)}%</td>
                        <td>${patient.Deterioration_Prediction === "1" ? 
                            `<span class="risk-badge risk-high">Likely (${(parseFloat(patient.Deterioration_Probability) * 100).toFixed(1)}%)</span>` : 
                            `<span class="risk-badge risk-low">Unlikely (${(parseFloat(patient.Deterioration_Probability) * 100).toFixed(1)}%)</span>`
                        }</td>
                        <td>
                            <div class="tag-container">${alertsHtml}</div>
                        </td>
                        <td>
                            <button class="view-details-btn" onclick="togglePatientDetail('${patientId}')">
                                <span class="btn-icon">+</span>
                                <span class="btn-text">View Details</span>
                                <span class="btn-text-alt">Close</span>
                            </button>
                        </td>
                    </tr>
                    <tr id="patient-detail-row-${patientId}" class="patient-detail-row" style="display: none;">
                        <td colspan="6" class="patient-detail-content" id="patient-detail-content-${patientId}">
                            <!-- Patient details will be populated here -->
                        </td>
                    </tr>
                `;
            }
            
            tbody.innerHTML = html;
            
            // Store the current page in data attribute for pagination
            const table = document.getElementById('patient-data-table');
            if (table) {
                table.setAttribute('data-current-page', page);
            }
        }
        
        // Setup pagination controls with improved styling
        function setupPagination(totalPages, currentPage) {
            const container = document.getElementById('pagination-container');
            
            if (!container || totalPages <= 1) {
                if (container) container.innerHTML = '';
                return;
            }
            
            const patients = dashboardData.filteredPatients || dashboardData.patients;
            const itemsPerPage = 5;
            const total = patients.length;
            const start = (currentPage - 1) * itemsPerPage + 1;
            const end = Math.min(currentPage * itemsPerPage, total);
            
            let html = '';
            
            // Previous button
            html += `<button class="page-btn" ${currentPage === 1 ? 'disabled' : ''} onclick="changePage(${currentPage - 1})">❮</button>`;
            
            // Generate page numbers
            if (totalPages <= 7) {
                // Show all pages if 7 or fewer
                for (let i = 1; i <= totalPages; i++) {
                    html += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">${i}</button>`;
                }
            } else {
                // Show first page
                html += `<button class="page-btn ${currentPage === 1 ? 'active' : ''}" onclick="changePage(1)">1</button>`;
                
                // If current page is far from the beginning, show ellipsis
                if (currentPage > 3) {
                    html += `<button class="page-btn" disabled>...</button>`;
                }
                
                // Show pages around current page
                const startPage = Math.max(2, currentPage - 1);
                const endPage = Math.min(totalPages - 1, currentPage + 1);
                
                for (let i = startPage; i <= endPage; i++) {
                    html += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">${i}</button>`;
                }
                
                // If current page is far from the end, show ellipsis
                if (currentPage < totalPages - 2) {
                    html += `<button class="page-btn" disabled>...</button>`;
                }
                
                // Show last page
                html += `<button class="page-btn ${currentPage === totalPages ? 'active' : ''}" onclick="changePage(${totalPages})">${totalPages}</button>`;
            }
            
            // Next button
            html += `<button class="page-btn" ${currentPage === totalPages ? 'disabled' : ''} onclick="changePage(${currentPage + 1})">❯</button>`;
            
            // Add page counter text
            html += `<span class="page-text">Showing ${start}-${end} of ${total}</span>`;
            
            container.innerHTML = html;
        }
        
        // Change page in patient table
        function changePage(newPage) {
            const patients = dashboardData.filteredPatients || dashboardData.patients;
            const itemsPerPage = 5;
            const totalPages = Math.ceil(patients.length / itemsPerPage);
            
            // Validate page number
            if (newPage < 1 || newPage > totalPages) {
                return;
            }
            
            // Close any open detail rows when changing page
            const allDetailRows = document.querySelectorAll('.patient-detail-row');
            const allButtons = document.querySelectorAll('.view-details-btn');
            
            allDetailRows.forEach(row => {
                row.style.display = 'none';
            });
            
            allButtons.forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Update current page and re-render
            if (dashboardData.filteredPatients) {
                renderFilteredPatientPage(newPage);
            } else {
                renderPatientPage(newPage);
            }
            setupPagination(totalPages, newPage);
        }
        
        // Toggle patient detail accordion
        function togglePatientDetail(patientId) {
            const detailRow = document.getElementById(`patient-detail-row-${patientId}`);
            const detailContent = document.getElementById(`patient-detail-content-${patientId}`);
            const button = document.querySelector(`#patient-row-${patientId} .view-details-btn`);
            
            // If the detail row is already displayed, hide it
            if (detailRow.style.display === 'table-row') {
                detailRow.style.display = 'none';
                detailContent.classList.remove('active');
                button.classList.remove('active');
                return;
            }
            
            // Hide any other open details
            const allDetailRows = document.querySelectorAll('.patient-detail-row');
            const allButtons = document.querySelectorAll('.view-details-btn');
            
            allDetailRows.forEach(row => {
                row.style.display = 'none';
            });
            
            allButtons.forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show this patient's details
            detailRow.style.display = 'table-row';
            button.classList.add('active');
            
            // Find the patient data
            const patient = dashboardData.patients.find(p => p.PatientID === patientId);
            
            if (!patient) {
                detailContent.innerHTML = `
                    <div class="patient-detail-card">
                        <div class="loading error">
                            Patient with ID ${patientId} not found.
                        </div>
                    </div>
                `;
                detailContent.classList.add('active');
                return;
            }
            
            // Prepare patient details content
            const riskLevel = patient.Risk_Level;
            let riskClass = "";
            
            if (riskLevel.includes("High")) {
                riskClass = "risk-high";
            } else if (riskLevel.includes("Medium")) {
                riskClass = "risk-medium";
            } else {
                riskClass = "risk-low";
            }
            
            // Format risk score and deterioration probability
            const riskScore = (parseFloat(patient.Risk_Score) * 100).toFixed(1) + '%';
            const deteriorationProb = (parseFloat(patient.Deterioration_Probability) * 100).toFixed(1) + '%';
            
            // Format clinical alerts
            let alertsHtml = "";
            if (patient.Clinical_Alerts && patient.Clinical_Alerts !== "No_Alerts") {
                const alerts = patient.Clinical_Alerts.split('|');
                alertsHtml = alerts.map(alert => {
                    const isCritical = alert.includes("CRITICAL");
                    return `<span class="tag ${isCritical ? 'alert-tag' : ''}">${alert.replace(/_/g, ' ')}</span>`;
                }).join('');
            } else {
                alertsHtml = '<span class="tag">No Alerts</span>';
            }
            
            // Format predicted conditions
            let conditionsHtml = "";
            if (patient.Predicted_Chronic_Conditions && patient.Predicted_Chronic_Conditions !== "None") {
                const conditions = patient.Predicted_Chronic_Conditions.split('|');
                conditionsHtml = conditions.map(condition => `<span class="tag">${condition.replace(/_/g, ' ')}</span>`).join('');
            } else {
                conditionsHtml = '<span class="tag">None Identified</span>';
            }
            
            // Format risk factors
            let riskFactorsHtml = "";
            if (patient.Top_Risk_Factors && patient.Top_Risk_Factors !== "None_Identified") {
                const factors = patient.Top_Risk_Factors.split('|');
                riskFactorsHtml = factors.map(factor => `<li>${factor.replace(/_/g, ' ')}</li>`).join('');
            } else {
                riskFactorsHtml = '<li>None identified</li>';
            }
            
            // Build HTML for patient detail
            let html = `
                <div class="patient-detail-card">
                    <div class="patient-detail-header">
                        <h3 class="patient-detail-title">
                            <span>👤</span> Patient ${patientId} Details
                        </h3>
                        <span class="risk-badge ${riskClass}">${riskLevel.replace(/-/g, ' ')} Risk</span>
                    </div>
                    
                    <div class="patient-metrics">
                        <div class="metric-box ${patient.Deterioration_Prediction === '1' ? 'highlighted' : ''}">
                            <div class="metric-title">Deterioration</div>
                            <div class="metric-value">${patient.Deterioration_Prediction === '1' ? 'Likely' : 'Unlikely'}</div>
                            <div class="metric-title">${deteriorationProb}</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-title">Risk Score</div>
                            <div class="metric-value">${riskScore}</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-title">Days of Data</div>
                            <div class="metric-value">${patient.Days_of_Data}</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-title">Last Recorded</div>
                            <div class="metric-value">Day ${patient.Last_Recorded_Day}</div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div class="patient-detail-section">
                            <h4>Clinical Alerts</h4>
                            <div class="tag-container">
                                ${alertsHtml}
                            </div>
                        </div>
                        
                        <div class="patient-detail-section">
                            <h4>Predicted Chronic Conditions</h4>
                            <div class="tag-container">
                                ${conditionsHtml}
                            </div>
                        </div>
                        
                        <div class="patient-detail-section">
                            <h4>Top Risk Factors</h4>
                            <ul class="recommendation-list">
                                ${riskFactorsHtml}
                            </ul>
                        </div>
                    </div>
                </div>
            `;
            
            detailContent.innerHTML = html;
            detailContent.classList.add('active');
        }
    
        // Filter patients based on search and risk level
        function filterPatients() {
            const searchInput = document.getElementById('patient-search');
            const riskFilter = document.getElementById('risk-filter');
            
            const searchTerm = searchInput.value.toLowerCase();
            const selectedRisk = riskFilter.value;
            
            // Filter the patients array
            let filteredPatients = dashboardData.patients.filter(patient => {
                // Search filter (check across all fields)
                const matchesSearch = Object.values(patient).some(value => 
                    value && typeof value === 'string' && value.toLowerCase().includes(searchTerm)
                );
                
                // Risk level filter
                let matchesRisk = true;
                if (selectedRisk !== 'all') {
                    const riskLevel = patient.Risk_Level.toLowerCase();
                    matchesRisk = riskLevel.includes(selectedRisk.toLowerCase());
                }
                
                return matchesSearch && matchesRisk;
            });
            
            // Update global variable to use for pagination
            dashboardData.filteredPatients = filteredPatients;
            
            // Close any open detail rows when filtering
            const allDetailRows = document.querySelectorAll('.patient-detail-row');
            const allButtons = document.querySelectorAll('.view-details-btn');
            
            allDetailRows.forEach(row => {
                row.style.display = 'none';
            });
            
            allButtons.forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Re-render the table with the first page of filtered results
            renderFilteredPatientPage(1);
        }
        
        // Render filtered patient data page
        function renderFilteredPatientPage(page) {
            const tbody = document.getElementById('patient-table-body');
            const itemsPerPage = 5;
            const patients = dashboardData.filteredPatients || dashboardData.patients;
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, patients.length);
            const totalPages = Math.ceil(patients.length / itemsPerPage);
            
            if (patients.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6" class="empty-state">No patients match your search criteria.</td></tr>`;
                setupPagination(1, 1);
                return;
            }
            
            let html = '';
            
            // Generate rows for this page
            for (let i = startIndex; i < endIndex; i++) {
                const patient = patients[i];
                const patientId = patient.PatientID;
                
                // Determine risk class for styling
                let riskClass = "";
                const riskLevel = patient.Risk_Level;
                
                if (riskLevel.includes("High")) {
                    riskClass = "risk-high";
                } else if (riskLevel.includes("Medium")) {
                    riskClass = "risk-medium";
                } else {
                    riskClass = "risk-low";
                }
                
                // Format clinical alerts
                let alertsHtml = "";
                if (patient.Clinical_Alerts && patient.Clinical_Alerts !== "No_Alerts") {
                    const alerts = patient.Clinical_Alerts.split('|');
                    alertsHtml = alerts.map(alert => {
                        const isCritical = alert.includes("CRITICAL");
                        return `<span class="tag ${isCritical ? 'alert-tag' : ''}">${alert.replace(/_/g, ' ')}</span>`;
                    }).join('');
                } else {
                    alertsHtml = '<span class="tag">No Alerts</span>';
                }
                
                // Generate the row
                html += `
                    <tr id="patient-row-${patientId}" data-patient-id="${patientId}">
                        <td><strong>${patientId}</strong></td>
                        <td>
                            <span class="risk-badge ${riskClass}">${riskLevel.replace(/-/g, ' ')}</span>
                        </td>
                        <td>${(parseFloat(patient.Risk_Score) * 100).toFixed(1)}%</td>
                        <td>${patient.Deterioration_Prediction === "1" ? 
                            `<span class="risk-badge risk-high">Likely (${(parseFloat(patient.Deterioration_Probability) * 100).toFixed(1)}%)</span>` : 
                            `<span class="risk-badge risk-low">Unlikely (${(parseFloat(patient.Deterioration_Probability) * 100).toFixed(1)}%)</span>`
                        }</td>
                        <td>
                            <div class="tag-container">${alertsHtml}</div>
                        </td>
                        <td>
                            <button class="view-details-btn" onclick="togglePatientDetail('${patientId}')">
                                <span class="btn-icon">+</span>
                                <span class="btn-text">View Details</span>
                                <span class="btn-text-alt">Close</span>
                            </button>
                        </td>
                    </tr>
                    <tr id="patient-detail-row-${patientId}" class="patient-detail-row" style="display: none;">
                        <td colspan="6" class="patient-detail-content" id="patient-detail-content-${patientId}">
                            <!-- Patient details will be populated here -->
                        </td>
                    </tr>
                `;
            }
            
            tbody.innerHTML = html;
            setupPagination(totalPages, page);
            
            // Store the current page in data attribute for pagination
            const table = document.getElementById('patient-data-table');
            if (table) {
                table.setAttribute('data-current-page', page);
            }
        }
    </script>
</body>
</html>
